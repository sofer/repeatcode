<div id="header">
	<h1>
		<%= link_to 'Courses', courses_path %>
		&raquo; <%= @course.subject.name if @course %>
	</h1>
	<h2>
		<%= render :partial => 'global/course_links' %>
	</h2>
</div>

<div id="targets" class="main">
	
	<table>
		<tbody>
			<tr>
				<td class="left">
					Start date:
				</td>
				<td>
		 			<%= formatted_date @course.created_at %>
				</td>
			</tr>
			<tr>
				<td class="left">
					Estimated end date: 
				</td>
				<td>
					<%= formatted_date @course.end_date %>
				</td>
			</tr>
			<tr>
 				<td class="left">
					Number of questions awaiting a response
				</td>
				<td>
					<%= @course.backlog_count %>
				</td>
			</tr>
			<tr>
				<td class="left">
					Number of exercises begun
				</td>
				<td>
					<% questions = @course.questions.started.count; exercises = @course.subject.exercises.count %>
					<%=  questions %> out of 
					<%=  exercises %>
					(<%=  100 * questions / exercises %>%)
				</td>
			</tr>
			<tr>
				<td class="left">
					Number of correct responses [inaccurate]
				</td>
				<td>
					<% responses = @course.response_count(@course.lessons); all_time = @course.responses_on_completion %>
					<%= responses %> out of 
					<%= all_time %>
					(<%=  100 * responses / all_time %>%)
				</td>
			</tr>
		</tbody>
	</table>	

	<table>
		<thead>
			<tr>
				<td>

				</td>
				<td>
					24 hours
				</td>
				<td>
					1 week
				</td>
				<td>
					4 weeks
				</td>
				<td>
					16 weeks
				</td>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>
					Correct responses (% of target)
				</td>
				<% [1,7,28, 126].each do |days| %>
					<% progress = @course.progress_for_period(days) %>
					<td>
						<%= progress[0] %>
						<div class="correct">
							<%= progress[1] %>
						</div>
					</td>
				<% end %>
			</tr>
		</tbody>
	</table>

	<% form_for @course do |f| %>
	<table>
		<tbody>
			<tr>
				<td class="heading">
					Targets 
				</td>
				<td>
					Correct responses each lesson:  
					<%= f.text_field :lesson_target, :autocomplete => "off" %> 
				</td>
				<td>
					Lessons per week: 
					<%= f.text_field :weekly_target, :autocomplete => "off" %> 
				</td>
				<td>
					<%= f.submit "Update targets" %>
				</td>
			</tr>
		</tbody>
	</table>
	<% end %>
	
</div>

<div id="footer">
	<%= render :partial => 'global/toplevel_links' %>
</div>